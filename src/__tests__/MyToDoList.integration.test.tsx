import { render, screen, fireEvent, waitFor } from '@testing-library/react';\nimport { Provider } from 'react-redux';\nimport { configureStore } from '@reduxjs/toolkit';\nimport { rest } from 'msw';\nimport { setupServer } from 'msw/node';\nimport MyToDoList from '../components/MyToDoList';\nimport { appAPI } from '../service/api';\nimport type { Page, TaskItem } from '../types/userTask';\n\n// Mock data\nconst mockTasksPage: Page<TaskItem> = {\n  content: [\n    {\n      id: '1',\n      title: 'Test Task 1',\n      descriptionMd: 'Test description 1',\n      statusId: 2,\n      statusName: 'Todo',\n      priorityId: 1,\n      priorityName: 'Low',\n      dueAt: '2024-01-15T10:00:00Z',\n      estimateMinutes: 120,\n      spentMinutes: 60,\n      completedAt: null,\n      createdAt: '2024-01-01T00:00:00Z',\n      updatedAt: '2024-01-01T00:00:00Z',\n    },\n    {\n      id: '2',\n      title: 'Test Task 2',\n      descriptionMd: 'Test description 2',\n      statusId: 5,\n      statusName: 'Done',\n      priorityId: 3,\n      priorityName: 'High',\n      dueAt: '2024-01-10T10:00:00Z',\n      estimateMinutes: 60,\n      spentMinutes: 60,\n      completedAt: '2024-01-10T15:00:00Z',\n      createdAt: '2024-01-01T00:00:00Z',\n      updatedAt: '2024-01-10T15:00:00Z',\n    },\n  ],\n  totalElements: 2,\n  totalPages: 1,\n  size: 20,\n  number: 0,\n  first: true,\n  last: true,\n  numberOfElements: 2,\n};\n\n// MSW server setup\nconst server = setupServer(\n  rest.get('*/api/user/task', (req, res, ctx) => {\n    return res(ctx.json(mockTasksPage));\n  })\n);\n\nbeforeAll(() => server.listen());\nafterEach(() => server.resetHandlers());\nafterAll(() => server.close());\n\nconst createTestStore = () => {\n  return configureStore({\n    reducer: {\n      [appAPI.reducerPath]: appAPI.reducer,\n    },\n    middleware: (getDefaultMiddleware) =>\n      getDefaultMiddleware().concat(appAPI.middleware),\n  });\n};\n\nconst renderMyToDoList = () => {\n  const store = createTestStore();\n  return render(\n    <Provider store={store}>\n      <MyToDoList />\n    </Provider>\n  );\n};\n\ndescribe('MyToDoList Integration', () => {\n  it('renders loading state initially', () => {\n    renderMyToDoList();\n    expect(screen.getByText('Loading tasks...')).toBeInTheDocument();\n  });\n\n  it('renders task list after loading', async () => {\n    renderMyToDoList();\n    \n    await waitFor(() => {\n      expect(screen.getByText('Test Task 1')).toBeInTheDocument();\n      expect(screen.getByText('Test Task 2')).toBeInTheDocument();\n    });\n  });\n\n  it('displays task details correctly', async () => {\n    renderMyToDoList();\n    \n    await waitFor(() => {\n      expect(screen.getByText('Todo')).toBeInTheDocument();\n      expect(screen.getByText('Done')).toBeInTheDocument();\n      expect(screen.getByText('Low')).toBeInTheDocument();\n      expect(screen.getByText('High')).toBeInTheDocument();\n    });\n  });\n\n  it('renders filter controls', async () => {\n    renderMyToDoList();\n    \n    expect(screen.getByLabelText('Status')).toBeInTheDocument();\n    expect(screen.getByLabelText('Search')).toBeInTheDocument();\n    expect(screen.getByLabelText('From Date')).toBeInTheDocument();\n    expect(screen.getByLabelText('To Date')).toBeInTheDocument();\n  });\n\n  it('handles search filter', async () => {\n    renderMyToDoList();\n    \n    const searchInput = screen.getByLabelText('Search');\n    fireEvent.change(searchInput, { target: { value: 'test search' } });\n    \n    expect(searchInput).toHaveValue('test search');\n  });\n\n  it('handles status filter', async () => {\n    renderMyToDoList();\n    \n    const statusSelect = screen.getByLabelText('Status');\n    fireEvent.change(statusSelect, { target: { value: '2' } });\n    \n    expect(statusSelect).toHaveValue('2');\n  });\n\n  it('handles error state', async () => {\n    server.use(\n      rest.get('*/api/user/task', (req, res, ctx) => {\n        return res(ctx.status(500), ctx.json({ message: 'Server error' }));\n      })\n    );\n    \n    renderMyToDoList();\n    \n    await waitFor(() => {\n      expect(screen.getByText('Error loading tasks')).toBeInTheDocument();\n      expect(screen.getByText('Retry')).toBeInTheDocument();\n    });\n  });\n\n  it('handles empty state', async () => {\n    server.use(\n      rest.get('*/api/user/task', (req, res, ctx) => {\n        return res(ctx.json({ ...mockTasksPage, content: [], totalElements: 0 }));\n      })\n    );\n    \n    renderMyToDoList();\n    \n    await waitFor(() => {\n      expect(screen.getByText('No tasks found. Try adjusting your filters.')).toBeInTheDocument();\n    });\n  });\n});